<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- Мета-информация -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToldYouNotToTell</title>
  
  <!-- Подключение стилей и шрифтов -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  
  <style>
    /* Основные переменные цветов для темной темы */
    :root {
      --bg-color: #0a0e17;
      --text-color: #e0e0e0;
      --primary-color: #5d7ebc;
      --secondary-color: #1a1f2d;
      --card-bg: rgba(10, 14, 23, 0.85);
      --border-color: rgba(255, 255, 255, 0.15);
      --comment-bg: rgba(255, 255, 255, 0.1);
      --overlay-bg: rgba(0, 0, 0, 0.9);
      --search-bg: rgba(255, 255, 255, 0.1);
      --error-color: #ff6b6b;
      --icon-color: #bbb;
      --star-counter-color: #aaa;
      --sort-btn-bg: rgba(255,255,255,0.15);
      --sort-btn-active-bg: #5d7ebc;
      --star-color: gold;
      --post-side-padding: 15px;
      --post-content-padding: 30px;
      --moderator-color: #ff5722;
      --category-color: #0a0a2a;
      --category-text-color: #5d7ebc;
      --boost-basic-color: #4CAF50;
      --boost-start-plus-color: #9C27B0;
      --boost-advanced-color: #2196F3;
      --boost-premium-color: #00BCD4;
      --boost-elite-color: #607D8B;
      --boost-sponsor-color: #FFC107;
      --staking-color: #FF5722;
    }

    /* Переменные для светлой темы */
    .light-mode {
      --bg-color: #f5f7fa;
      --text-color: #333333;
      --primary-color: #4a6fa5;
      --secondary-color: #e0e6ed;
      --card-bg: rgba(245, 247, 250, 0.95);
      --border-color: rgba(0, 0, 0, 0.2);
      --comment-bg: rgba(0, 0, 0, 0.05);
      --overlay-bg: rgba(255, 255, 255, 0.95);
      --search-bg: rgba(0, 0, 0, 0.08);
      --error-color: #e63946;
      --icon-color: #666;
      --star-counter-color: #777;
      --sort-btn-bg: rgba(74, 111, 165, 0.2);
      --sort-btn-active-bg: #4a6fa5;
      --star-color: gold;
      --moderator-color: #e91e63;
      --category-color: #0a0a2a;
      --category-text-color: #4a6fa5;
    }

    /* Основные стили страницы */
    body {
      margin: 0;
      font-family: 'Tahoma', sans-serif;
      background: url('https://imagizer.imageshack.com/img924/2739/6DOg7G.jpg') no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      position: relative;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Шапка сайта */
    .header-bar {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: rgba(10, 14, 23, 0.9);
      font-size: 18px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      color: var(--text-color);
    }

    .light-mode .header-bar {
      background: rgba(245, 247, 250, 0.95);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    /* Логотип */
    .logo {
      font-weight: bold;
      font-size: 22px;
      margin-right: 15px;
      color: var(--text-color);
      white-space: nowrap;
    }

    /* Поле поиска */
    .search-box {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      width: 100%;
      max-width: 200px;
      background: var(--search-bg);
      color: var(--text-color);
      font-size: 14px;
    }

    /* Кнопка добавления поста */
    .add-post-btn {
      margin-left: auto;
      padding: 8px 12px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
      font-size: 14px;
      white-space: nowrap;
    }

    .add-post-btn:hover {
      background: #3a5a8f;
    }

    /* Сортировка постов */
    .sort {
      text-align: center;
      margin: 10px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .sort button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      cursor: pointer;
      color: white;
      transition: all 0.3s;
    }

    .light-mode .sort button {
      color: white;
    }

    .sort button.active {
      background: var(--sort-btn-active-bg);
      color: white;
      font-weight: bold;
    }

    /* Контейнер для постов */
    .post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 10px;
    }

    /* Стиль отдельного поста */
    .post {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 12px var(--post-side-padding);
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      position: relative;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .light-mode .post {
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    /* Номер поста (перенесен под корзину) */
    .post-number {
      position: absolute;
      top: 45px;
      right: 15px;
      font-size: 12px;
      color: var(--icon-color);
      background: rgba(93, 126, 188, 0.2);
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* Рейтинг поста */
    .rating-container {
      position: absolute;
      bottom: 15px;
      right: var(--post-side-padding);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .star {
      color: var(--icon-color);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .star.active {
      color: var(--star-color);
    }
    
    .star-counter {
      font-size: 14px;
      color: var(--star-counter-color);
    }

    /* Текст поста */
    .post p {
      color: var(--text-color);
      line-height: 1.6;
      font-size: 16px;
      margin: 0px 0;
      padding: var(--post-content-padding);
      padding-top: 0;
      padding-right: 50px;
      padding-left: 40px;
      white-space: pre-wrap;
    }

    /* Кнопка Phantom Wallet */
    .phantom-btn {
      margin-left: 12px;
      padding: 8px 12px;
      background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .phantom-btn i {
      font-size: 16px;
    }

    /* Водяной знак */
    .watermark {
      position: absolute;
      bottom: 5px;
      right: 10px;
      font-family: 'Great Vibes', cursive;
      font-size: 18px;
      color: #000000;
    }

    /* Форма добавления поста */
    .add-post-form {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--overlay-bg);
      padding: 15px;
      border-radius: 8px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 25px rgba(93, 126, 188, 0.5);
      z-index: 999;
      border: 1px solid var(--border-color);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Группы полей формы */
    .form-group {
      margin-bottom: 12px;
      padding-right: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 3px;
      font-weight: bold;
      color: var(--primary-color);
      font-size: 15px;
    }

    .form-group input, 
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-family: 'Tahoma';
      font-size: 16px;
      background: var(--search-bg);
      color: var(--text-color);
    }

    .form-group textarea {
      min-height: 150px;
      resize: vertical;
    }

    /* Кнопки формы */
    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 15px;
      padding-right: 25px;
    }

    .form-actions button {
      padding: 8px 15px;
      margin-left: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
    }

    .form-actions button[type="button"] {
      background: rgba(255,255,255,0.1);
      color: var(--text-color);
    }

    .light-mode .form-actions button[type="button"] {
      background: rgba(0,0,0,0.1);
      color: var(--text-color);
    }

    .form-actions button[type="submit"] {
      background: var(--primary-color);
      color: white;
    }

    /* Иконки шаринга */
    .share-icons {
      margin: 10px 0;
    }

    .share-icons i {
      margin-right: 10px;
      font-size: 18px;
      cursor: pointer;
      color: var(--icon-color);
      transition: color 0.2s;
    }

    .share-icons i:hover {
      color: var(--primary-color);
    }

    /* Комментарии */
    .comments {
      margin-top: 15px;
      border-top: 1px solid var(--border-color);
      padding-top: 15px;
    }

    .comments textarea {
      width: 100%;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      font-family: 'Tahoma';
      border: 1px solid var(--border-color);
      background: var(--search-bg);
      color: var(--text-color);
      resize: vertical;
      font-size: 15px;
    }

    /* Кнопка переключения комментариев */
    .toggle-comments-btn {
      background: none;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 15px;
      padding: 5px 0;
      font-weight: 500;
    }

    /* Список комментариев */
    .comment-list {
      margin-top: 10px;
    }

    /* Отдельный комментарий */
    .comment {
      padding: 10px;
      background: var(--comment-bg);
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 15px;
      color: var(--text-color);
      line-height: 1.4;
      position: relative;
    }

    .comment.editing {
      padding: 0;
      background: transparent;
    }

    .comment-content {
      padding-right: 40px;
    }

    /* Поле редактирования комментария */
    .comment-edit-input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background: var(--search-bg);
      color: var(--text-color);
      font-family: 'Tahoma';
      font-size: 15px;
      resize: vertical;
    }

    /* Действия с комментарием */
    .comment-actions {
      position: absolute;
      top: 5px;
      right: 5px;
      display: flex;
      gap: 5px;
    }

    .comment-actions button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--icon-color);
      font-size: 12px;
      padding: 2px;
    }

    .comment-actions button:hover {
      color: var(--primary-color);
    }

    /* Кнопки редактирования */
    .edit-actions {
      display: flex;
      justify-content: flex-end;
      gap: 5px;
      margin-top: 5px;
    }

    .edit-actions button {
      padding: 5px 10px;
      font-size: 13px;
      border-radius: 3px;
      border: none;
      cursor: pointer;
    }

    .edit-save {
      background: var(--primary-color);
      color: white;
    }

    .edit-cancel {
      background: var(--secondary-color);
      color: white;
    }

    /* Оверлей */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 998;
    }

    /* Дата поста */
    .post-date {
      font-size: 12px;
      color: var(--icon-color);
      margin: 0px 0 0 0;
    }

    /* Действия с постом */
    .post-actions {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      gap: 8px;
    }

    .post-actions button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--icon-color);
      font-size: 15px;
      transition: color 0.3s;
    }

    .post-actions button:hover {
      color: var(--primary-color);
    }

    /* Заголовок поста */
    .post h3 {
      color: var(--primary-color);
      margin-top: 5px;
      margin-bottom: 25px;
      margin-right: 60px;
      margin-left: 40px;
      font-size: 20px;
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* Превью скриншота */
    .screenshot-preview {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      z-index: 1001;
      box-shadow: 0 0 25px rgba(0,0,0,0.5);
    }

    .screenshot-content {
      position: relative;
      text-align: center;
      font-family: 'Tahoma', sans-serif;
      color: #000000;
    }

    .screenshot-content > div {
      border: 2px double #000;
      border-width: 4px;
      padding: 30px;
      padding-top: 10px;   
      padding-bottom: 45px;
      background: white;
      position: relative;
      max-width: 500px;
      margin: 0 auto;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .screenshot-content h3 {
      color: #000000;
      margin-top: 0;
      margin-bottom: 18px;
      text-align: center;
    }

    .screenshot-content p {
      text-align: left;  
      margin: 0;
      padding: 0;
    }

    .close-screenshot {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: var(--icon-color);
      font-size: 20px;
      cursor: pointer;
    }

    /* Кнопка "Наверх" */
    .back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      display: none;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      z-index: 99;
      transition: opacity 0.3s;
    }

    .back-to-top:hover {
      opacity: 0.9;
    }

    /* Переключатель темы */
    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 18px;
      cursor: pointer;
      margin-left: 12px;
      padding: 0;
      display: flex;
      align-items: center;
    }

    /* Таймер редактирования */
    .edit-timer {
      position: absolute;
      bottom: 15px;
      left: 350px;
      font-size: 12px;
      color: var(--icon-color);
      cursor: help;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Кнопка репорта */
    .report-button {
      position: absolute;
      bottom: 15px;
      right: 60px;
      background: none;
      border: none;
      color: var(--icon-color);
      font-size: 16px;
      cursor: pointer;
    }

    .report-button:hover {
      color: var(--error-color);
    }

    /* Модальное окно с кодом восстановления */
    .recovery-code-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--overlay-bg);
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      z-index: 1000;
      box-shadow: 0 0 25px rgba(93, 126, 188, 0.5);
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .recovery-code-modal h2 {
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .recovery-code {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
      padding: 10px;
      background: rgba(93, 126, 188, 0.1);
      border-radius: 4px;
      letter-spacing: 2px;
      position: relative;
    }

    .copy-code {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--icon-color);
      cursor: pointer;
    }

    .copy-code:hover {
      color: var(--primary-color);
    }

    /* Подсказки */
    .info-tooltip {
      cursor: help;
      margin-left: 5px;
      color: var(--primary-color);
    }

    .info-tooltip .tooltip-text {
      visibility: hidden;
      width: 300px;
      background-color: var(--secondary-color);
      color: var(--text-color);
      text-align: left;
      border-radius: 6px;
      padding: 15px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
      line-height: 1.5;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .info-tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    /* Текст комментария */
    .comment-text {
      padding-left: 0;
    }

    /* Всплывающая подсказка */
    .tooltip-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--overlay-bg);
      padding: 20px;
      border-radius: 8px;
      max-width: 300px;
      z-index: 1001;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      text-align: center;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Кнопка меню навигации */
    .nav-toggle {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 20px;
      cursor: pointer;
      margin-left: 12px;
      padding: 0 8px;
    }

    /* Меню навигации */
    .nav-menu {
      display: none;
      position: absolute;
      top: 60px;
      right: 15px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      z-index: 1000;
      min-width: 200px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .nav-menu.show {
      display: block;
    }

    .nav-menu a {
      display: block;
      padding: 10px 15px;
      color: var(--text-color);
      text-decoration: none;
      transition: background 0.3s;
    }

    .nav-menu a:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Тег категории */
    .category-tag {
      display: inline-block;
      padding: 3px 8px;
      background: rgba(93, 126, 188, 0.2);
      border-radius: 12px;
      font-size: 12px;
      margin-right: 5px;
      color: var(--category-text-color);
      margin-top: 5px;
      position: absolute;
      bottom: 15px;
      right: 100px;
    }

    /* Кнопка буста */
    .boost-btn {
      position: absolute;
      bottom: 15px;
      left: 400px;
      background: none;
      border: none;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
    }

    .boost-btn:hover {
      color: #14F195;
    }

    /* Бейдж модератора */
    .moderator-badge {
      display: inline-block;
      margin-left: 10px;
      color: var(--moderator-color);
      cursor: help;
      position: relative;
    }

    .moderator-tooltip {
      visibility: hidden;
      width: 250px;
      background-color: var(--secondary-color);
      color: var(--text-color);
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 13px;
      line-height: 1.4;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .moderator-badge:hover .moderator-tooltip {
      visibility: visible;
      opacity: 1;
    }

    /* Панель репортов */
    .reports-panel {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--overlay-bg);
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1001;
      box-shadow: 0 0 25px rgba(93, 126, 188, 0.5);
      border: 1px solid var(--border-color);
    }

    .reports-panel h2 {
      margin-top: 0;
      color: var(--primary-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .report-item {
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .report-actions {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }

    .report-actions button {
      padding: 5px 10px;
      font-size: 13px;
      border-radius: 3px;
      border: none;
      cursor: pointer;
    }

    .report-dismiss {
      background: var(--secondary-color);
      color: white;
    }

    .report-delete {
      background: var(--error-color);
      color: white;
    }

    /* Стили для бустированных постов */
    

    

    .boost-start-plus::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 0.5px solid rgba(136, 136, 136, 0.1);
      pointer-events: none;
      border-radius: 8px;
    }

    

    .boost-advanced::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 0.5px solid rgba(136, 136, 136, 0.1);
      pointer-events: none;
      border-radius: 8px;
    }

    

    .boost-premium::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 0.5px solid rgba(136, 136, 136, 0.1);
      pointer-events: none;
      border-radius: 8px;
      background-image: linear-gradient(135deg, rgba(173, 216, 230, 0.05) 0%, transparent 50%, rgba(173, 216, 230, 0.05) 100%);
      background-size: 200% 200%;
      animation: wave 5s linear infinite;
    }

    

    .boost-elite::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 0.5px solid rgba(136, 136, 136, 0.1);
      pointer-events: none;
      border-radius: 8px;
      background-image: 
        linear-gradient(45deg, rgba(255, 255, 255, 0.03) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.03) 75%, rgba(255, 255, 255, 0.03)),
        linear-gradient(45deg, rgba(255, 255, 255, 0.03) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.03) 75%, rgba(255, 255, 255, 0.03));
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
    }

    

    .boost-sponsor::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 0.5px solid rgba(255, 215, 0, 0.15);
      pointer-events: none;
      border-radius: 8px;
      background-image: 
        radial-gradient(circle, rgba(255, 215, 0, 0.07) 1px, transparent 1px);
      background-size: 15px 15px;
    }

    .staking-post {
      border-left: 4px solid var(--staking-color);
    }

    @keyframes wave {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }

    /* Кнопка Rewards Pool */
    .rewards-pool-btn {
  position: absolute !important;
  right: 10px !important;
  top: 45px !important;
  font-size: 78px !important;
  margin: 0 !important;
  padding: 0 !important;
  width: auto !important;
  height: auto !important;
  background: none !important;
  border: none !important;
  z-index: 100 !important;
}

    .rewards-pool-btn:hover {
      color: var(--boost-elite-color);
    }

    .rewards-pool-btn .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: var(--secondary-color);
      color: var(--text-color);
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
    }

    .rewards-pool-btn:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    /* Кнопка Stake */
    .stake-btn {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      background: rgba(255, 87, 34, 0.2);
      border-radius: 6px;
      cursor: pointer;
      color: var(--staking-color);
      transition: all 0.3s;
    }

    .stake-btn:hover {
      background: rgba(255, 87, 34, 0.3);
    }

    /* Подразделы сортировки Top */
    .top-subsorts {
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 5px;
    }

    .top-subsorts button {
      margin: 3px;
      padding: 5px 8px;
      font-size: 12px;
      border: none;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
      cursor: pointer;
      color: white;
    }

    .top-subsorts button.active {
      background: var(--primary-color);
    }

    /* Адаптивность для мобильных устройств */
    @media (max-width: 480px) {
      .header-bar {
        flex-wrap: wrap;
        gap: 8px;
      }
      
      .logo {
        font-size: 20px;
        margin-right: auto;
      }
      
      .search-box {
        order: 3;
        max-width: 100%;
        margin-top: 8px;
      }
      
      .add-post-btn {
        padding: 8px 10px;
        font-size: 14px;
      }
      
      .theme-toggle {
        margin-left: 8px;
        font-size: 16px;
      }
      
      .post {
        padding: 14px;
      }
      
      .post h3 {
        font-size: 18px;
        margin-right: 50px;
        margin-left: 30px;
      }
      
      .post p {
        font-size: 15px;
        padding-left: 30px;
      }

      .comment {
        font-size: 14px;
      }
      
      .post-actions {
        top: 10px;
        right: 10px;
      }
      
      .post-number {
        top: 20px;
        right: 10px;
      }

      .edit-timer {
        left: 10px;
        transform: none;
      }

      .boost-btn {
        left: 70px;
        transform: none;
      }

      .sort button {
        padding: 7px 10px;
        font-size: 13px;
      }

      .back-to-top {
        width: 40px;
        height: 40px;
        font-size: 16px;
        bottom: 15px;
        right: 15px;
      }

      .report-button {
        right: 50px;
      }

      .category-tag {
        right: 80px;
      }

      .rewards-pool-btn {
  position: absolute !important;
  right: 10px !important;
  top: 45px !important;
  font-size: 78px !important;
  margin: 0 !important;
  padding: 0 !important;
  width: auto !important;
  height: auto !important;
  background: none !important;
  border: none !important;
  z-index: 100 !important;
}

      .stake-btn {
        padding: 5px 8px;
        font-size: 12px;
      }
    }

    /* Стили для выпадающего списка категорий */
    select option {
      color: #000000;
      background-color: #ffffff;
    }

    /* Стили для кнопки загрузки */
    .download-btn {
      display: none;
    }

    /* Стили для страницы продвижения */
    .promotion-page {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .promotion-page h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 20px;
    }

    .boost-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 15px;
    }

    .boost-table th, .boost-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .boost-table th {
      background-color: var(--primary-color);
      color: white;
    }

    .boost-table tr:nth-child(even) {
      background-color: var(--secondary-color);
    }

    .boost-table tr:hover {
      background-color: rgba(93, 126, 188, 0.1);
    }

    .boost-badge { font-size: 25px; 
      
    }

    /* Стили для страницы наград */
    .rewards-page {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .rewards-page h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 20px;
    }

    /* Стили для страницы стейкинга */
    .staking-page {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .staking-page h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 20px;
    }

    /* Анимации переходов */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    /* Стили для кнопки Pay with USDT */
    .pay-with-usdt {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background: linear-gradient(135deg, #26A69A 0%, #4CAF50 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .pay-with-usdt:hover {
      opacity: 0.9;
    }
  
.presale-btn {
  margin-left: 12px;
  padding: 8px 12px;
  background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
  color: #000;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: bold;
}
.presale-btn:hover {
  opacity: 0.9;
}
.presale-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--overlay-bg);
  padding: 20px;
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
  z-index: 1001;
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
  border: 1px solid var(--border-color);
}
.presale-modal h2 {
  color: #FFD700;
  text-align: center;
}

</style>
</head>
<body>
  <!-- Шапка сайта -->
  <div class="header-bar">
    <div class="logo">ToldYouNotToTell</div>
    <input type="text" class="search-box" placeholder="Search by number, title or recovery code..." oninput="searchPosts(this.value)">
    <button class="add-post-btn" onclick="toggleForm()">+ New Note</button>
    <button class="phantom-btn" onclick="connectPhantom()"><i class="fas fa-wallet"></i> Connect</button>
<button class="presale-btn" onclick="showPresaleModal()">
  <i class="fas fa-coins"></i> Presale
</button>
    <button class="nav-toggle" onclick="toggleNavMenu()"><i class="fas fa-bars"></i></button>
    <button class="theme-toggle" onclick="toggleTheme()">
      <i class="fas fa-moon"></i>
    </button>
  </div>

  <!-- Меню навигации -->
  <div class="nav-menu" id="navMenu">
    <a href="#" onclick="toggleMyPostsFilter(); toggleNavMenu(); return false;" id="navMenuMyPosts">My Posts</a>
    <a href="#" onclick="showCurrentBoosts(); toggleNavMenu(); return false;">Current Boosts</a>
    <a href="#" onclick="showMyRewards(); toggleNavMenu(); return false;">My Rewards</a>
    <a href="#" onclick="showPromotionPage(); toggleNavMenu(); return false;">Promotion</a>
    <a href="#" onclick="showFAQ(); toggleNavMenu(); return false;">FAQ</a>
    <a href="#" onclick="showReportsPanel(); toggleNavMenu(); return false;" id="moderatorLink" style="display:block;">Moderator Panel</a>
  </div>

  <!-- Сортировка постов -->
  <div class="sort">
    <button class="rewards-pool-btn" onclick="showRewardsPage()" title="Rewards Pool">
      💎
      <span class="tooltip-text" id="rewardsTooltip">Loading rewards info...</span>
    </button>
    <button onclick="sortPosts('new')" class="active"><i class="fas fa-clock"></i> New</button>
    <button onclick="sortPosts('top')"><i class="fas fa-star"></i> Top</button>
    <button onclick="sortPosts('random')"><i class="fas fa-random"></i> Random</button>
    <button onclick="sortPosts('trending')"><i class="fas fa-fire"></i> Trending</button>
    <button class="stake-btn" onclick="showStakingPage()"><i class="fas fa-lock"></i> Stake TNTT</button>
  </div>

  <!-- Контейнер для постов -->
  <div class="post-container" id="posts">
    <!-- Посты будут добавляться сюда -->
  </div>

  <!-- Страница продвижения -->
  <div class="promotion-page" id="promotionPage" style="display: none;">
    <h1>Boosting and Trending System</h1>
    <p>Users can promote their posts to appear in the Trending section by paying fixed amounts in USDT via Phantom Wallet. The promotion algorithm is designed so that priority depends on the amount paid, but all posts are subject to rotation and gradual priority decay.</p>
    
<table class="boost-table">
  <thead>
    <tr>
      <th>Tier</th>
      <th>Price</th>
      <th>Badge</th>
      <th>Trending Time</th>
      <th>Priority Decay</th>
      <th>Perks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Basic</td>
      <td>$5</td>
      <td class="boost-badge">🌱</td>
      <td>2 hours</td>
      <td>-30%</td>
      <td>Above all free posts</td>
    </tr>
    <tr>
      <td>Start+</td>
      <td>$10</td>
      <td class="boost-badge">🧸</td>
      <td>5 hours</td>
      <td>-25%</td>
      <td>Longer visibility retention</td>
    </tr>
    <tr>
      <td>Advanced</td>
      <td>$30</td>
      <td class="boost-badge">🐇</td>
      <td>15 hours</td>
      <td>-15%</td>
      <td>High rotation priority</td>
    </tr>
    <tr>
      <td>Premium</td>
      <td>$50</td>
      <td class="boost-badge">🐬</td>
      <td>30 hours</td>
      <td>-10%</td>
      <td>Stable promotion</td>
    </tr>
    <tr>
      <td>Elite</td>
      <td>$100</td>
      <td class="boost-badge">💎</td>
      <td>80 hours</td>
      <td>-5%</td>
      <td>Higher position in Trending</td>
    </tr>
    <tr>
      <td>Sponsor</td>
      <td>$250</td>
      <td class="boost-badge">👑</td>
      <td>200 hours</td>
      <td>-2%</td>
      <td>Maximum reach</td>
    </tr>
  </tbody>
</table>
    
    <div class="info-tooltip">
      <i class="fas fa-info-circle"></i>
      <span class="tooltip-text">
        <strong>Rotation:</strong> Posts with the same boost tier are rotated every 15 minutes (hidden from users).<br><br>
        <strong>Rules:</strong> One pattern per post, all options are optional, effects are disabled on mobile.
      </span>
    </div>
    
    <button class="pay-with-usdt" onclick="payWithUSDT()">
      <i class="fas fa-wallet"></i> Pay with USDT
    </button>
    
    <div class="form-actions">
      <button type="button" onclick="hidePromotionPage()" style="margin-top: 20px;">Back to Posts</button>
    </div>
  </div>

  <!-- Страница наград -->
  <div class="rewards-page" id="rewardsPage" style="display: none;">
    <h1>Rewards Pool</h1>
    <div id="rewardsContent">
      <!-- Контент будет добавлен сюда -->
    </div>
    <div class="form-actions">
      <button type="button" onclick="hideRewardsPage()" style="margin-top: 20px;">Back to Posts</button>
    </div>
  </div>

  <!-- Страница стейкинга -->
  <div class="staking-page" id="stakingPage" style="display: none;">
    <h1>Stake TNTT Tokens</h1>
    <div id="stakingContent">
      <!-- Контент будет добавлен сюда -->
    </div>
    <div class="form-actions">
      <button type="button" onclick="hideStakingPage()" style="margin-top: 20px;">Back to Posts</button>
    </div>
  </div>

  <!-- Страница текущих бустов -->
  <div class="promotion-page" id="currentBoostsPage" style="display: none;">
    <h1>Your Current Boosts</h1>
    <div id="currentBoostsContent">
      <!-- Контент будет добавлен сюда -->
    </div>
    <div class="form-actions">
      <button type="button" onclick="hideCurrentBoosts()" style="margin-top: 20px;">Back to Posts</button>
    </div>
  </div>

  <!-- Страница ваших наград -->
  <div class="rewards-page" id="myRewardsPage" style="display: none;">
    <h1>Your Rewards</h1>
    <div id="myRewardsContent">
      <!-- Контент будет добавлен сюда -->
    </div>
    <div class="form-actions">
      <button type="button" onclick="hideMyRewards()" style="margin-top: 20px;">Back to Posts</button>
    </div>
  </div>

  <!-- Кнопка "Наверх" -->
  <button class="back-to-top" onclick="scrollToTop()" title="Back to top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Оверлей -->
  <div class="overlay" id="overlay" onclick="toggleForm(); closeNavMenu(); hidePromotionPage(); hideRewardsPage(); hideStakingPage(); hideCurrentBoosts(); hideMyRewards();"></div>

  <!-- Форма добавления поста -->
  <div class="add-post-form" id="addPostForm">
    <h2 id="formTitle">New Note</h2>
    <form id="postForm">
      <input type="hidden" id="postId">
      <div class="form-group">
        <label for="postTitle">Title</label>
        <input type="text" id="postTitle" required maxlength="100" minlength="10">
        <div id="titleCounter" style="font-size: 12px; text-align: right; color: var(--icon-color);">0/100</div>
      </div>
      <div class="form-group">
        <label for="postCategory">Category</label>
        <select id="postCategory" style="width: calc(100% - 24px);">
          <option value="">Select a category</option>
          <option value="Work">Work</option>
          <option value="Love">Love</option>
          <option value="Animals">Animals</option>
          <option value="Children">Children</option>
          <option value="Society">Society</option>
          <option value="Friendship">Friendship</option>
          <option value="Betrayal">Betrayal</option>
          <option value="Secret">Secret</option>
          <option value="Dark past">Dark past</option>
          <option value="Cheating">Cheating</option>
          <option value="Dating">Dating</option>
          <option value="Fails">Fails</option>
          <option value="Shame">Shame</option>
          <option value="Guilt">Guilt</option>
          <option value="Revenge">Revenge</option>
          <option value="Breakdown">Breakdown</option>
          <option value="Deception">Deception</option>
          <option value="Mistakes">Mistakes</option>
          <option value="Pain">Pain</option>
          <option value="Repentance">Repentance</option>
          <option value="Forbidden">Forbidden</option>
          <option value="Loneliness">Loneliness</option>
          <option value="Loss">Loss</option>
          <option value="Temptation">Temptation</option>
          <option value="Funny">Funny</option>
          <option value="Risk">Risk</option>
          <option value="Hope">Hope</option>
          <option value="Private thoughts">Private thoughts</option>
          <option value="Observations">Observations</option>
          <option value="Nature">Nature</option>
          <option value="Art">Art</option>
          <option value="Study">Study</option>
          <option value="Travel">Travel</option>
          <option value="Business">Business</option>
          <option value="Mystic">Mystic</option>
          <option value="Dreams">Dreams</option>
          <option value="Hate">Hate</option>
          <option value="Family">Family</option>
          <option value="Success">Success</option>
          <option value="Scary">Scary</option>
          <option value="Jealousy">Jealousy</option>
          <option value="Happiness">Happiness</option>
          <option value="Goodness">Goodness</option>
          <option value="Social networks">Social networks</option>
        </select>
      </div>
      <div class="form-group">
        <label for="postContent">Content</label>
        <textarea id="postContent" rows="8" required maxlength="650" minlength="100"></textarea>
        <div id="contentCounter" style="font-size: 12px; text-align: right; color: var(--icon-color);">0/650</div>
      </div>
      <div class="form-actions">
        <button type="button" onclick="toggleForm()">Cancel</button>
        <button type="submit" id="submitBtn">Publish</button>
      </div>
    </form>
  </div>

  <!-- Превью скриншота -->
  <div class="screenshot-preview" id="screenshotPreview">
    <button class="close-screenshot" onclick="closeScreenshot()">&times;</button>
    <div class="screenshot-content" id="screenshotContent">
      <!-- Контент будет добавлен сюда -->
    </div>
  </div>
  <div class="overlay" id="screenshotOverlay" style="display: none;"></div>

  <!-- Модальное окно с кодом восстановления -->
  <div class="recovery-code-modal" id="recoveryCodeModal">
    <h2>Save this code - it's your key to stories <div class="info-tooltip">
      <i class="fas fa-info-circle"></i>
      <span class="tooltip-text">If you clear your browser cache or access from another device, this code will restore access to your anonymous posts. Write it down or save it in a safe place!</span>
    </div></h2>
    <div class="recovery-code" id="recoveryCodeDisplay">
      <span id="codeText"></span>
      <button class="copy-code" onclick="copyRecoveryCode()" title="Copy code"><i class="far fa-copy"></i></button>
    </div>
    <div class="form-actions">
      <button type="button" onclick="downloadRecoveryCode()"><i class="fas fa-download"></i> Download</button>
      <button type="button" onclick="closeRecoveryModal()">Close</button>
    </div>
  </div>

  <!-- Панель репортов -->
  <div class="reports-panel" id="reportsPanel">
    <h2>Moderator Panel <button onclick="closeReportsPanel()" style="background: none; border: none; color: var(--icon-color); cursor: pointer;"><i class="fas fa-times"></i></button></h2>
    <div id="reportsList">
      <!-- Репорты будут добавлены сюда -->
    </div>
  </div>

  <script>
    // Глобальные переменные
    let posts = [];
    let currentPostId = null;
    let currentTheme = 'dark';
    const userVotes = JSON.parse(localStorage.getItem('userVotes')) || {};
    const userIPs = JSON.parse(localStorage.getItem('userIPs')) || {};
    const commentAuthors = JSON.parse(localStorage.getItem('commentAuthors')) || {};
    let phantomWallet = null;
    let showOnlyMyPosts = false;
    let recoveryCodes = JSON.parse(localStorage.getItem('recoveryCodes')) || {};
    let currentRecoveryCode = '';
    let reports = JSON.parse(localStorage.getItem('reports')) || [];
    const MODERATOR_IP = '192.168.1.1'; // Замените на реальный IP или используйте другой идентификатор
    const MODERATOR_WALLET = 'YourWalletAddressHere'; // Замените на реальный адрес кошелька
    let isModerator = true; // Принудительно делаем пользователя модератором

    // Константы для бустов и наград
    const BOOST_TIERS = {
      5: { decay: 0.3, min: 0, max: 5 },
      10: { decay: 0.25, min: 5, max: 10 },
      30: { decay: 0.15, min: 10, max: 30 },
      50: { decay: 0.1, min: 30, max: 50 },
      100: { decay: 0.05, min: 50, max: 100 },
      250: { decay: 0.02, min: 100, max: Infinity }
    };

    const STAKING_LEVELS = {
      10000: 1,
      25000: 2,
      50000: 3,
      100000: 4,
      200000: 5
    };

    const REWARD_DISTRIBUTION = {
      TOP_POSTS: 0.5,
      BURN: 0.2,
      TEAM: 0.1,
      STAKING_POOL: 0.15,
      TREASURY: 0.05
    };

    const VISUAL_STYLES = {
      BOOST_TIERS: {
        5: { class: 'boost-basic', icon: '🌱', color: '#4CAF50' },
        10: { class: 'boost-start-plus', icon: '🧸', color: '#9C27B0' },
        30: { class: 'boost-advanced', icon: '🐇', color: '#2196F3' },
        50: { class: 'boost-premium', icon: '🐬', color: '#00BCD4' },
        100: { class: 'boost-elite', icon: '💎', color: '#607D8B' },
        250: { class: 'boost-sponsor', icon: '👑', color: '#FFC107' }
      },
      STAKING: {
        class: 'staking-post',
        icon: '⭐',
        color: '#FF5722'
      }
    };

    // Запрещенные слова для модерации
    const bannedWords = [
      'хуй', 'пизда', 'ебал', 'ебан', 'еблан', 'мудак', 'сука', 'блядь', 
      'fuck', 'shit', 'asshole', 'bitch', 'cunt', 'nigger', 'nigga', 'faggot'
    ];
    
    // Функция модерации текста
    function moderateText(text) {
      let moderated = text;
      bannedWords.forEach(word => {
        const regex = new RegExp(word, 'gi');
        moderated = moderated.replace(regex, '*'.repeat(word.length));
      });
      return moderated;
    }

    // Проверка контента с помощью AI
    async function checkContentWithAI(text) {
      try {
        const response = await fetch('https://api.deepseek.com/v1/moderate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer sk-44db4594ca1147aaa2ab3fab15a646c9'
          },
          body: JSON.stringify({
            text: text,
            strictness: 'high'
          })
        });
        
        const result = await response.json();
        return result.is_approved === false;
      } catch (error) {
        console.error('AI moderation error:', error);
        return false;
      }
    }

    // Получение IP пользователя
    async function getUserIP() {
      try {
        if (!localStorage.getItem('userIP')) {
          const randomIP = `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
          localStorage.setItem('userIP', randomIP);
        }
        return localStorage.getItem('userIP');
      } catch (error) {
        console.error('Error getting IP:', error);
        return 'unknown';
      }
    }

    // Генерация кода восстановления
    function generateRecoveryCode() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let result = '';
      for (let i = 0; i < 8; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    // Показать модальное окно с кодом восстановления
    function showRecoveryModal(code) {
      currentRecoveryCode = code;
      document.getElementById('codeText').textContent = code;
      document.getElementById('recoveryCodeModal').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    // Закрыть модальное окно с кодом восстановления
    function closeRecoveryModal() {
      document.getElementById('recoveryCodeModal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    // Копировать код восстановления
    function copyRecoveryCode() {
      navigator.clipboard.writeText(currentRecoveryCode);
      showTooltip('Recovery code copied to clipboard!');
    }

    // Скачать код восстановления
    function downloadRecoveryCode() {
      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(`ToldYouNotToTell Recovery Code: ${currentRecoveryCode}`));
      element.setAttribute('download', `ToldYouNotToTell-recovery-${currentRecoveryCode}.txt`);
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }

    // Показать информацию о времени редактирования
    function showEditTimeInfo() {
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip-box';
      tooltip.innerHTML = `
        <p>Your stories can be edited or deleted only within the first 3 hours. This is a place for truthful stories that don't fade with time. Speak honestly, your voice matters forever</p>
        <button onclick="this.parentNode.remove()" style="margin-top: 10px; padding: 5px 10px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">OK</button>
      `;
      document.body.appendChild(tooltip);
    }

    // Показать всплывающую подсказку
    function showTooltip(message) {
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip-box';
      tooltip.innerHTML = `
        <p>${message}</p>
        <button onclick="this.parentNode.remove()" style="margin-top: 10px; padding: 5px 10px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">OK</button>
      `;
      document.body.appendChild(tooltip);
    }

    // Переключить меню навигации
    function toggleNavMenu() {
      document.getElementById('navMenu').classList.toggle('show');
    }

    // Закрыть меню навигации
    function closeNavMenu() {
      document.getElementById('navMenu').classList.remove('show');
    }

    // Показать страницу продвижения
    function showPromotionPage() {
      document.getElementById('promotionPage').style.display = 'block';
      document.getElementById('posts').style.display = 'none';
      document.querySelector('.sort').style.display = 'none';
      document.getElementById('promotionPage').classList.add('fade-in');
    }

    // Скрыть страницу продвижения
    function hidePromotionPage() {
      document.getElementById('promotionPage').style.display = 'none';
      document.getElementById('posts').style.display = 'block';
      document.querySelector('.sort').style.display = 'flex';
    }

    // Показать страницу наград
    function showRewardsPage() {
      document.getElementById('rewardsPage').style.display = 'block';
      document.getElementById('posts').style.display = 'none';
      document.querySelector('.sort').style.display = 'none';
      document.getElementById('rewardsPage').classList.add('fade-in');
      updateRewardsInfo();
    }

    // Скрыть страницу наград
    function hideRewardsPage() {
      document.getElementById('rewardsPage').style.display = 'none';
      document.getElementById('posts').style.display = 'block';
      document.querySelector('.sort').style.display = 'flex';
    }

    // Показать страницу стейкинга
    function showStakingPage() {
      document.getElementById('stakingPage').style.display = 'block';
      document.getElementById('posts').style.display = 'none';
      document.querySelector('.sort').style.display = 'none';
      document.getElementById('stakingPage').classList.add('fade-in');
      updateStakingInfo();
    }

    // Скрыть страницу стейкинга
    function hideStakingPage() {
      document.getElementById('stakingPage').style.display = 'none';
      document.getElementById('posts').style.display = 'block';
      document.querySelector('.sort').style.display = 'flex';
    }

    // Показать текущие бусты пользователя
    function showCurrentBoosts() {
      document.getElementById('currentBoostsPage').style.display = 'block';
      document.getElementById('posts').style.display = 'none';
      document.querySelector('.sort').style.display = 'none';
      document.getElementById('currentBoostsPage').classList.add('fade-in');
      updateCurrentBoosts();
    }

    // Скрыть текущие бусты пользователя
    function hideCurrentBoosts() {
      document.getElementById('currentBoostsPage').style.display = 'none';
      document.getElementById('posts').style.display = 'block';
      document.querySelector('.sort').style.display = 'flex';
    }

    // Показать награды пользователя
    function showMyRewards() {
      document.getElementById('myRewardsPage').style.display = 'block';
      document.getElementById('posts').style.display = 'none';
      document.querySelector('.sort').style.display = 'none';
      document.getElementById('myRewardsPage').classList.add('fade-in');
      updateMyRewards();
    }

    // Скрыть награды пользователя
    function hideMyRewards() {
      document.getElementById('myRewardsPage').style.display = 'none';
      document.getElementById('posts').style.display = 'block';
      document.querySelector('.sort').style.display = 'flex';
    }

    // Обновить информацию о наградах
    function updateRewardsInfo() {
      const now = new Date();
      const nextDistribution = new Date(now);
      nextDistribution.setDate(nextDistribution.getDate() + 1);
      nextDistribution.setHours(0, 0, 0, 0);
      
      const timeLeft = nextDistribution - now;
      const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
      const minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      
      const rewardsContent = document.getElementById('rewardsContent');
      rewardsContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px;">
          <h3>Next Reward Distribution</h3>
          <p>${hoursLeft}h ${minutesLeft}m remaining</p>
        </div>
        <div style="margin-bottom: 20px;">
          <h3>Current Rewards Pool</h3>
          <p>1000 TNTT</p>
        </div>
        <div>
          <h3>Distribution Structure</h3>
          <ul>
            <li>Top 10 Posts: 50% — equally split among Top-sorted posts every 24h</li>
            <li>Token Burn: 20%</li>
            <li>Team: 10%</li>
            <li>Staking Pool: 15%</li>
            <li>Treasury: 5%</li>
          </ul>
        </div>
      `;
      
      document.getElementById('rewardsTooltip').textContent = `Pool: 1000 TNTT | Next in ${hoursLeft}h ${minutesLeft}m`;
    }

    // Обновить информацию о стейкинге
    function updateStakingInfo() {
      const stakingContent = document.getElementById('stakingContent');
      stakingContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px;"><p>Stake your TNTT tokens to earn rewards and increase your visibility</p>
        </div>
        <div style="margin-bottom: 20px;">
          <label for="stakeAmount">Amount to Stake:</label>
          <input type="number" id="stakeAmount" style="width: calc(100% - 16px); padding: 8px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--search-bg); color: var(--text-color);">
        </div>
        <div style="margin-bottom: 20px;">
          <h3>Staking Levels</h3>
          <ul>
            <li>10,000 TNTT: Level 1</li>
            <li>25,000 TNTT: Level 2</li>
            <li>50,000 TNTT: Level 3</li>
            <li>100,000 TNTT: Level 4</li>
            <li>200,000 TNTT: Level 5</li>
          </ul>
        </div>
        <button onclick="stakeTokens()" style="width: 100%; padding: 10px; background: var(--staking-color); color: white; border: none; border-radius: 4px; cursor: pointer;">Stake Tokens</button>
      `;
    }

    // Обновить текущие бусты пользователя
    async function updateCurrentBoosts() {
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const userWallet = localStorage.getItem('phantomWallet');
      
      const userPosts = posts.filter(post => 
        (walletConnected && post.authorWallet === userWallet) || 
        (!walletConnected && post.authorIP === userIP));
      
      const boostedPosts = userPosts.filter(post => post.boostAmount);
      
      const currentBoostsContent = document.getElementById('currentBoostsContent');
      
      if (boostedPosts.length === 0) {
        currentBoostsContent.innerHTML = '<p>You have no active boosts</p>';
        return;
      }
      
      let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
      html += `
        <thead>
          <tr>
            <th style="padding: 10px; border-bottom: 1px solid var(--border-color); text-align: left;">Post</th>
            <th style="padding: 10px; border-bottom: 1px solid var(--border-color); text-align: left;">Tier</th>
            <th style="padding: 10px; border-bottom: 1px solid var(--border-color); text-align: left;">Time Left</th>
            <th style="padding: 10px; border-bottom: 1px solid var(--border-color); text-align: left;">Boost Weight</th>
          </tr>
        </thead>
        <tbody>
      `;
      
      const now = Date.now();
      
      boostedPosts.forEach(post => {
        const hoursPassed = (now - post.boostTime) / 3600000;
        const decay = BOOST_TIERS[post.boostAmount]?.decay || 0.3;
        const boostWeight = Math.max(0, post.boostAmount * Math.pow(1 - decay, hoursPassed));
        const hoursLeft = Math.floor((post.boostTime + (BOOST_TIERS[post.boostAmount]?.maxHours || 2) * 3600000 - now) / 3600000);
        
        html += `
          <tr>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${post.title}</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${getTierName(post.boostAmount)}</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${hoursLeft}h</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${boostWeight.toFixed(2)}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table></div>';
      currentBoostsContent.innerHTML = html;
    }

    // Обновить награды пользователя
    async function updateMyRewards() {
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const userWallet = localStorage.getItem('phantomWallet');
      
      const myRewardsContent = document.getElementById('myRewardsContent');
      myRewardsContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px;"><p>Total Earned: 500 TNTT</p>
        </div>
        <div style="margin-bottom: 20px;">
          <h3>Recent Rewards</h3>
          <ul>
            <li>Post "I've never gone on a date sober": 50 TNTT</li>
            <li>Post "I once invented a person because I felt unloved": 75 TNTT</li>
            <li>Staking Rewards: 375 TNTT</li>
          </ul>
        </div>
        <button onclick="claimRewards()" style="width: 100%; padding: 10px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">Claim Rewards</button>
      `;
    }

    // Получить название уровня буста
    function getTierName(amount) {
      switch(amount) {
        case 5: return 'Basic 🌱';
        case 10: return 'Start+ 🧸';
        case 30: return 'Advanced 🐇';
        case 50: return 'Premium 🐬';
        case 100: return 'Elite 💎';
        case 250: return 'Sponsor 👑';
        default: return 'Unknown';
      }
    }

    // Показать FAQ
    function showFAQ() {
      showTooltip('FAQ: 1. How to recover posts? Use your recovery code in the search box. 2. Can I edit posts? Only within 3 hours of creation. 3. Is it anonymous? Yes, completely!');
    }

    // Загрузка постов
    async function loadPosts() {
      try {
        const userIP = await getUserIP();
        const savedPosts = localStorage.getItem('posts');
        if (savedPosts) {
          posts = JSON.parse(savedPosts);
          posts.forEach(post => {
            post.date = new Date(post.date);
            if (post.comments) {
              post.comments.forEach(comment => {
                if (!commentAuthors[comment.id]) {
                  commentAuthors[comment.id] = userIP;
                }
              });
            }
          });
          // Сортировка по дате (новые сначала)
          posts.sort((a, b) => b.date - a.date);
          // Переназначение порядковых номеров
          posts.forEach((post, index) => {
            post.orderNumber = posts.length - index;
          });
        } else {
          initializeDefaultPosts();
        }

        // Проверка, является ли пользователь модератором
        isModerator = true; // Всегда модератор
        if (isModerator) {
          document.getElementById('moderatorLink').style.display = 'block';
        }

        renderPosts(posts);
        startTimerUpdates(); // Запуск обновления таймеров
        startHourlyUpdates(); // Запуск часовых обновлений
      } catch (error) {
        console.error('Error loading posts:', error);
        initializeDefaultPosts();
        renderPosts(posts);
        startTimerUpdates();
        startHourlyUpdates();
      }
    }

    // Запуск обновления таймеров
    function startTimerUpdates() {
      setInterval(() => {
        const timerElements = document.querySelectorAll('.edit-timer');
        timerElements.forEach(timer => {
          const postId = parseInt(timer.closest('.post').dataset.id);
          const post = posts.find(p => p.id === postId);
          if (post) {
            const timeLeft = getTimeLeftForEdit(post.date);
            if (timeLeft) {
              timer.innerHTML = `<i class="fas fa-hourglass-half"></i> ${timeLeft.hours}h ${timeLeft.minutes}m`;
            } else {
              timer.remove();
            }
          }
        });
      }, 60000); // 60 секунд
    }

    // Запуск часовых обновлений
    function startHourlyUpdates() {
      setInterval(() => {
        updateBoostWeights();
        checkRewardEligibility();
        updateRewardsInfo();
      }, 3600000); // Каждый час
    }

    // Обновить веса бустов
    function updateBoostWeights() {
      const now = Date.now();
      posts.forEach(post => {
        if (post.boostAmount && post.boostTime) {
          const hoursPassed = (now - post.boostTime) / 3600000;
          const decay = BOOST_TIERS[post.boostAmount]?.decay || 0.3;
          post.currentBoostWeight = Math.max(0, 
            post.boostAmount * Math.pow(1 - decay, hoursPassed));
          
          // Обновление визуального стиля
          updatePostVisuals(post);
        }
      });
    }

    // Проверить право на награды
    function checkRewardEligibility() {
      // В реальном приложении здесь была бы проверка права на награды
    }

    // Инициализация тестовых постов
    function initializeDefaultPosts() {
      const randomIPs = Array(25).fill().map(() => 
        `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`
      );
      
      const randomDate = () => {
        const start = new Date(2025, 3, 12); // 12 апреля 2025
        const end = new Date(2025, 3, 15); // 15 апреля 2025
        return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
      };

      const randomVotes = () => {
        const count = Math.floor(Math.random() * 20) + 1;
        return Array(count).fill().map(() => 
          `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`
        );
      };

      const randomComments = () => {
        const comments = [
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "Wow, this really hits home. I've been through something similar last year." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "Haha, I can totally picture this happening! Thanks for the laugh." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I'm not sure I agree with this, but I respect your honesty." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This made me tear up a little. Sending you virtual hugs." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "OMG, I did the exact same thing last week! What are the odds?" },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I needed to hear this today. Thank you for sharing your story." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This is so relatable it hurts. You're not alone in this." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I can't stop laughing at this! You made my day better." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This deserves way more upvotes. Such a powerful message." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I'm both laughing and crying at the same time. So bittersweet." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "You're so brave for sharing this. I admire your courage." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This is why I love this platform - raw, unfiltered honesty." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I felt this in my soul. Thank you for putting it into words." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "Why is this so painfully accurate? You nailed it." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This should be a movie scene. So dramatic and real!" },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "You brave soul. I hope things get better for you." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This is peak human experience right here. So universal." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I'm both horrified and fascinated by this story. Wow." },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "This is the content I come here for. Keep them coming!" },
          { id: Date.now() + Math.floor(Math.random() * 1000), text: "I can't believe you actually did that! What happened next?" }
        ];
        
        // Выбор 0-3 случайных комментариев для каждого поста
        const count = Math.floor(Math.random() * 4);
        const shuffled = [...comments].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      };

      posts = [
        {
          id: 1,
          title: "I've never gone on a date sober",
          content: "I always have a drink beforehand - it helps with the nerves and makes me feel less boring.",
          voters: randomVotes(),
          date: randomDate(),
          comments: randomComments(),
          orderNumber: 25,
          authorIP: randomIPs[0],
          category: "Dating"
        },
        {
          id: 2,
          title: "I once invented a person because I felt unloved",
          content: "Sounds crazy, I know. But I wrote him letters like he was real.\nHonestly, it saved me. Sometimes your imagination is kinder than real life.",
          voters: randomVotes(),
          date: randomDate(),
          comments: randomComments(),
          orderNumber: 24,
          authorIP: randomIPs[1],
          category: "Loneliness"
        },
        {
          id: 3,
          title: "I once stole a dog",
          content: "She was tied up outside a store, sitting on the cold pavement. The owner was yelling on the phone, yanking her leash. She whimpered.\nWhen he went inside, I just untied her and walked away. We've been together ever since - three years now.\nNot a shred of guilt.",
          voters: randomVotes(),
          date: randomDate(),
          comments: randomComments(),
          orderNumber: 23,
          authorIP: randomIPs[2],
          category: "Animals"
        },
        {
          id: 4,
          title: "Faked a cough so I wouldn't fart on a first date",
          content: "The cough came out strangely loud. It scared the girl so much she choked on her latte.\nNo second date. But hey - no fart either.",
          voters: randomVotes(),
          date: randomDate(),
          comments: randomComments(),
          orderNumber: 22,
          authorIP: randomIPs[3],
          category: "Dating",
          boostAmount: 5,
          boostTime: Date.now() - 3600000, // 1 час назад
          currentBoostWeight: 4.5
        }
      ];

      // Сортировка по дате (старые сначала) для назначения правильных порядковых номеров
      posts.sort((a, b) => a.date - b.date);
      posts.forEach((post, index) => {
        post.orderNumber = index + 1;
      });
      // Затем сортировка по дате (новые сначала) для отображения
      posts.sort((a, b) => b.date - a.date);

      posts.forEach(post => {
        if (post.comments && post.comments.length > 0) {
          post.comments.forEach(comment => {
            if (!commentAuthors[comment.id]) {
              commentAuthors[comment.id] = randomIPs[Math.floor(Math.random() * randomIPs.length)];
            }
          });
        }
      });
      
      localStorage.setItem('commentAuthors', JSON.stringify(commentAuthors));
    }

    // Сохранение постов
    async function savePosts() {
      try {
        localStorage.setItem('posts', JSON.stringify(posts));
        localStorage.setItem('commentAuthors', JSON.stringify(commentAuthors));
        localStorage.setItem('recoveryCodes', JSON.stringify(recoveryCodes));
        localStorage.setItem('reports', JSON.stringify(reports));
      } catch (error) {
        console.error('Error saving posts:', error);
        showTooltip('Error saving data. Please try again.');
      }
    }

    // Подключение Phantom Wallet
    async function connectPhantom() {
      try {
        if (window.solana && window.solana.isPhantom) {
          phantomWallet = window.solana;
          
          // Сначала проверяем, подключен ли уже кошелек
          if (!phantomWallet.isConnected) {
            await phantomWallet.connect();
          }
          
          const publicKey = phantomWallet.publicKey.toString();
          
          // Обновление UI для отображения подключенного кошелька
          const phantomBtn = document.querySelector('.phantom-btn');
          phantomBtn.innerHTML = `<i class="fas fa-wallet"></i> ${publicKey.substring(0, 4)}...${publicKey.substring(publicKey.length - 4)}`;
          phantomBtn.style.background = 'linear-gradient(135deg, #14F195 0%, #9945FF 100%)';
          
          // Сохранение информации о кошельке
          localStorage.setItem('phantomWallet', publicKey);
          
          // Проверка, является ли модератором
          if (publicKey === MODERATOR_WALLET) {
            isModerator = true;
            document.getElementById('moderatorLink').style.display = 'block';
          }
          
          showTooltip(`Connected to Phantom Wallet: ${publicKey.substring(0, 6)}...${publicKey.substring(publicKey.length - 4)}`);
        } else {
          showTooltip('Phantom Wallet not detected! Please install it from https://phantom.app/');
          window.open('https://phantom.app/', '_blank');
        }
      } catch (error) {
        console.error('Error connecting to Phantom:', error);
        if (error.message.includes('User rejected the request')) {
          showTooltip('You rejected the connection request');
        } else {
          showTooltip('Failed to connect to Phantom Wallet');
        }
      }
    }

    // Проверка подключения Phantom Wallet
    function checkPhantomConnection() {
      const savedWallet = localStorage.getItem('phantomWallet');
      if (savedWallet) {
        const phantomBtn = document.querySelector('.phantom-btn');
        phantomBtn.innerHTML = `<i class="fas fa-wallet"></i> ${savedWallet.substring(0, 4)}...${savedWallet.substring(savedWallet.length - 4)}`;
        phantomBtn.style.background = 'linear-gradient(135deg, #14F195 0%, #9945FF 100%)';
        
        // Проверка, является ли модератором
        if (savedWallet === MODERATOR_WALLET) {
          isModerator = true;
          document.getElementById('moderatorLink').style.display = 'block';
        }
      }
    }

    // Переключение фильтра "Мои посты"
    function toggleMyPostsFilter() {
      showOnlyMyPosts = !showOnlyMyPosts;
      const button = document.getElementById('navMenuMyPosts');
      button.textContent = showOnlyMyPosts ? 'All Posts' : 'My Posts';
      renderPosts(posts);
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', async function() {
      await loadPosts();
      checkPhantomConnection();
      
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        currentTheme = savedTheme;
        document.body.classList.toggle('light-mode', currentTheme === 'light');
        updateThemeIcon();
      }

      window.addEventListener('scroll', toggleBackToTopButton);

      // Настройка счетчиков символов
      document.getElementById('postTitle').addEventListener('input', function() {
        document.getElementById('titleCounter').textContent = `${this.value.length}/100`;
      });

      document.getElementById('postContent').addEventListener('input', function() {
        document.getElementById('contentCounter').textContent = `${this.value.length}/650`;
        // Удаление эмодзи
        const emojiRegex = /[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F1E0}-\u{1F1FF}]/gu;
        if (emojiRegex.test(this.value)) {
          this.value = this.value.replace(emojiRegex, '');
          showTooltip('Emojis are not allowed in posts.');
        }
      });
    });

    // Переключение кнопки "Наверх"
    function toggleBackToTopButton() {
      const backToTopButton = document.querySelector('.back-to-top');
      if (window.pageYOffset > 300) {
        backToTopButton.style.display = 'flex';
      } else {
        backToTopButton.style.display = 'none';
      }
    }

    // Прокрутка наверх
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // Получение оставшегося времени для редактирования
    function getTimeLeftForEdit(postDate) {
      const now = new Date();
      const postTime = new Date(postDate);
      const threeHours = 3 * 60 * 60 * 1000; // 3 часа в миллисекундах
      const timeLeft = threeHours - (now - postTime);
      
      if (timeLeft <= 0) return null;
      
      const hours = Math.floor(timeLeft / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      
      return {
        hours,
        minutes,
        percentage: (timeLeft / threeHours) * 100
      };
    }

    // Отрисовка постов
    async function renderPosts(postsToRender) {
      const postsContainer = document.getElementById('posts');
      postsContainer.innerHTML = '';
      
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      
      let filteredPosts = [...postsToRender];
      
      if (showOnlyMyPosts) {
        if (walletConnected) {
          const walletAddress = localStorage.getItem('phantomWallet');
          filteredPosts = filteredPosts.filter(post => post.authorWallet === walletAddress);
        } else {
          filteredPosts = filteredPosts.filter(post => post.authorIP === userIP);
        }
      }
      
      filteredPosts.forEach(post => {
        const postElement = document.createElement('div');
        postElement.className = 'post';
        postElement.dataset.id = post.id;
        postElement.dataset.date = post.date.getTime();
        postElement.dataset.title = escapeHtml(post.title.toLowerCase());
        postElement.dataset.number = post.orderNumber;
        
        const isAuthor = walletConnected ? 
          (post.authorWallet === localStorage.getItem('phantomWallet')) : 
          (post.authorIP === userIP);
        
        const hasVoted = post.voters && post.voters.includes(userIP);
        const timeLeft = getTimeLeftForEdit(post.date);
        
        // Проверка, был ли пост модерирован
        const moderatedBy = post.moderatedBy || '';
        const moderatorNote = post.moderatorNote || '';
        
        // Применение стилей буста
        let boostClass = '';
        if (post.boostAmount) {
          boostClass = VISUAL_STYLES.BOOST_TIERS[post.boostAmount]?.class || '';
        }
        
        postElement.innerHTML = `
          ${(isAuthor || isModerator) ? `
            <div class="post-actions">
              ${isModerator ? `<button onclick="moderatePost(${post.id})" title="Moderate"><i class="fas fa-gavel"></i></button>` : ''}
              <button onclick="editPost(${post.id})" title="Edit" ${(!timeLeft && !isModerator) ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}><i class="fas fa-edit"></i></button>
              <button onclick="deletePost(${post.id})" title="Delete" ${(!timeLeft && !isModerator) ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}><i class="fas fa-trash"></i></button>
            </div>
          ` : ''}
          <div class="post-number">#${post.orderNumber}</div>
          ${isAuthor && timeLeft ? `
            <div class="edit-timer" onclick="showEditTimeInfo()" title="Time left to edit">
              <i class="fas fa-hourglass-half"></i>
              ${timeLeft.hours}h ${timeLeft.minutes}m
            </div>
            <button class="boost-btn" onclick="boostPost(${post.id})" title="Boost post"><i class="fas fa-rocket"></i></button>
          ` : ''}
          ${moderatedBy ? `
            <div class="moderator-badge" title="This post was moderated">
              <i class="fas fa-shield-alt"></i>
              <span class="moderator-tooltip">Moderated by ${moderatedBy}. ${moderatorNote}</span>
            </div>
          ` : ''}
          <h3>${escapeHtml(post.title)}</h3>
          <p>${escapeHtml(post.content)}</p>
          ${post.category ? `<span class="category-tag">${post.category}</span>` : ''}
          <div class="post-date">${formatDate(post.date)}</div>
          <button class="report-button" onclick="reportPost(${post.id})" title="Report post"><i class="fas fa-flag"></i></button>
          <div class="rating-container">
            <i class="star ${hasVoted ? 'active' : ''}" onclick="ratePost(${post.id}, event)">★</i>
            <span class="star-counter">${post.voters ? post.voters.length : 0}</span>
          </div>
          <div class="share-icons">
            <i class="fab fa-x-twitter" title="Share on X" onclick="sharePostDirect('twitter', ${post.id})"></i>
            <i class="fab fa-facebook" title="Share on Facebook" onclick="sharePostDirect('facebook', ${post.id})"></i>
            <i class="fab fa-telegram" title="Share on Telegram" onclick="sharePostDirect('telegram', ${post.id})"></i>
            <i class="fab fa-whatsapp" title="Share on WhatsApp" onclick="sharePostDirect('whatsapp', ${post.id})"></i>
            <i class="fas fa-link" title="Copy link" onclick="copyPostLink(${post.id})"></i>
            <i class="fas fa-download" title="Download image" onclick="downloadPostImage(${post.id})"></i>
          </div>
          <button class="toggle-comments-btn" onclick="toggleComments(this)">${post.comments && post.comments.length > 0 ? `Comments (${post.comments.length})` : 'Add comment'}</button>
          <div class="comments" style="display:none;">
            ${post.comments && post.comments.length > 0 ? 
              `<div class="comment-list">${
                post.comments.map(c => `
                  <div class="comment" data-comment-id="${c.id}">
                    <div class="comment-text">${escapeHtml(c.text)}</div>
                    ${(commentAuthors[c.id] === userIP || isModerator) ? `
                      <div class="comment-actions">
                        <button onclick="startEditComment(${post.id}, ${c.id}, this)" title="Edit"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteComment(${post.id}, ${c.id})" title="Delete"><i class="fas fa-trash"></i></button>
                      </div>
                    ` : ''}
                  </div>
                `).join('')
              }</div>` : ''}
            <textarea placeholder="Leave a comment..."></textarea>
            <button onclick="addComment(${post.id}, this)">Send</button>
          </div>
        `;
        
        // Применение класса буста
        if (boostClass) {
          postElement.classList.add(boostClass);
        }
        
        postsContainer.appendChild(postElement);
      });
    }

    // Экранирование HTML
    function escapeHtml(unsafe) {
      if (!unsafe) return '';
      return unsafe
        .toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;")
        .replace(/\n/g, "<br>");
    }

    // Форматирование даты
    function formatDate(date) {
      if (!(date instanceof Date)) {
        date = new Date(date);
      }
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    // Переключение формы
    function toggleForm(post = null) {
      const form = document.getElementById('addPostForm');
      const overlay = document.getElementById('overlay');
      const formTitle = document.getElementById('formTitle');
      const submitBtn = document.getElementById('submitBtn');
      
      if (form.style.display === 'block') {
        form.style.display = 'none';
        overlay.style.display = 'none';
        document.getElementById('postForm').reset();
        document.getElementById('titleCounter').textContent = '0/100';
        document.getElementById('contentCounter').textContent = '0/650';
        document.getElementById('postCategory').value = '';
        currentPostId = null;
      } else {
        if (post) {
          formTitle.textContent = 'Edit Note';
          submitBtn.textContent = 'Save';
          document.getElementById('postId').value = post.id;
          document.getElementById('postTitle').value = post.title;
          document.getElementById('postContent').value = post.content;
          document.getElementById('postCategory').value = post.category || '';
          document.getElementById('titleCounter').textContent = `${post.title.length}/100`;
          document.getElementById('contentCounter').textContent = `${post.content.length}/650`;
          currentPostId = post.id;
        } else {
          formTitle.textContent = 'New Note';
          submitBtn.textContent = 'Publish';
          currentPostId = null;
        }
        form.style.display = 'block';
        overlay.style.display = 'block';
      }
    }

    // Обработка отправки формы
    document.getElementById('postForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      let title = document.getElementById('postTitle').value;
      let content = document.getElementById('postContent').value;
      const category = document.getElementById('postCategory').value;
      
      // Валидация длины
      if (title.length < 10 || title.length > 100) {
        showTooltip('Title must be between 10 and 100 characters');
        return;
      }
      
      if (content.length < 100 || content.length > 650) {
        showTooltip('Content must be between 100 and 650 characters');
        return;
      }
      
      // Модерация текста
      title = moderateText(title);
      content = moderateText(content);
      
      // Проверка с помощью AI модерации
      const isViolation = await checkContentWithAI(content);
      if (isViolation) {
        showTooltip('Your post contains content that violates our guidelines and cannot be published.');
        return;
      }
      
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      
      if (currentPostId) {
        const postIndex = posts.findIndex(p => p.id === currentPostId);
        if (postIndex !== -1) {
          const isAuthor = walletConnected ? 
            (posts[postIndex].authorWallet === localStorage.getItem('phantomWallet')) : 
            (posts[postIndex].authorIP === userIP);
          
          if (isAuthor || isModerator) {
            posts[postIndex].title = title;
            posts[postIndex].content = content;
            posts[postIndex].category = category;
            
            if (isModerator) {
              posts[postIndex].moderatedBy = 'Moderator';
              posts[postIndex].moderatorNote = 'Edited by moderator';
            }
          }
        }
      } else {
        const maxOrderNumber = posts.length > 0 ? Math.max(...posts.map(p => p.orderNumber)) : 0;
        const newPost = {
          id: Date.now(),
          title: title,
          content: content,
          category: category,
          voters: [],
          date: new Date(),
          comments: [],
          orderNumber: maxOrderNumber + 1,
          authorIP: walletConnected ? null : userIP,
          authorWallet: walletConnected ? localStorage.getItem('phantomWallet') : null
        };
        
        posts.unshift(newPost);
        
        // Генерация и показ кода восстановления для новых постов
        const recoveryCode = generateRecoveryCode();
        recoveryCodes[newPost.id] = recoveryCode;
        showRecoveryModal(recoveryCode);
      }
      
      // Сортировка по дате (новые сначала) и переназначение порядковых номеров
      posts.sort((a, b) => b.date - a.date);
      posts.forEach((post, index) => {
        post.orderNumber = posts.length - index;
      });
      
      renderPosts(posts);
      await savePosts();
      toggleForm();
    });

    // Оценка поста
    async function ratePost(postId, event) {
      event.stopPropagation();
      
      const post = posts.find(p => p.id === postId);
      const userIP = await getUserIP();
      
      if (!post) return;
      
      // Проверка, пытается ли автор проголосовать за свой пост
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const isAuthor = walletConnected ? 
        (post.authorWallet === localStorage.getItem('phantomWallet')) : 
        (post.authorIP === userIP);
      
      if (isAuthor) return;
      
      if (!post.voters) post.voters = [];
      
      const alreadyVoted = post.voters.includes(userIP);
      
      if (alreadyVoted) {
        post.voters = post.voters.filter(ip => ip !== userIP);
      } else {
        post.voters.push(userIP);
      }
      
      const postElement = document.querySelector(`.post[data-id="${postId}"]`);
      if (postElement) {
        const star = postElement.querySelector('.star');
        const counter = postElement.querySelector('.star-counter');
        
        star.classList.toggle('active', !alreadyVoted);
        counter.textContent = post.voters.length;
      }
      
      await savePosts();
    }

    // Сортировка постов
function sortPosts(type, period = null) {
  // Сначала обновляем активные кнопки
  if (type === 'top' && period) {
    document.querySelectorAll('.top-subsorts button').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');
  } else {
    document.querySelectorAll('.sort button:not(.stake-btn)').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');
  }

  let sortedPosts = [...posts];
  
  switch(type) {
    case 'new':
      sortedPosts.sort((a, b) => b.date - a.date);
      break;
      
    case 'top':
      if (period) {
        // Обработка подразделов (оставлено для совместимости)
        const now = new Date();
        let cutoffDate;
        
        switch(period) {
          case '5m': cutoffDate = new Date(now - 5 * 60 * 1000); break;
          case '30m': cutoffDate = new Date(now - 30 * 60 * 1000); break;
          case '1h': cutoffDate = new Date(now - 60 * 60 * 1000); break;
          case '24h': cutoffDate = new Date(now - 24 * 60 * 60 * 1000); break;
          case '1w': cutoffDate = new Date(now - 7 * 24 * 60 * 60 * 1000); break;
          case '1m': cutoffDate = new Date(now - 30 * 24 * 60 * 60 * 1000); break;
          case '6m': cutoffDate = new Date(now - 6 * 30 * 24 * 60 * 60 * 1000); break;
          case '1y': cutoffDate = new Date(now - 365 * 24 * 60 * 60 * 1000); break;
          default: cutoffDate = new Date(0);
        }
        
        sortedPosts = sortedPosts.filter(post => new Date(post.date) >= cutoffDate);
      } else {
        // Основная логика Top - 24 часа или все время
        const now = new Date();
        const oneDayAgo = new Date(now - 24 * 60 * 60 * 1000);
        const recentPosts = sortedPosts.filter(post => new Date(post.date) >= oneDayAgo);
        
        if (recentPosts.length > 0) {
          sortedPosts = recentPosts;
        }
      }
      
      sortedPosts.sort((a, b) => (b.voters?.length || 0) - (a.voters?.length || 0));
      break;
      
    case 'random':
      sortedPosts = shuffleArray([...posts]);
      break;
      
    case 'trending':
      const now = Date.now();
      
      sortedPosts.forEach(post => {
        if (post.boostAmount && post.boostTime) {
          const hoursPassed = (now - post.boostTime) / 3600000;
          const decay = BOOST_TIERS[post.boostAmount]?.decay || 0.3;
          post.currentBoostWeight = Math.max(0, 
            post.boostAmount * Math.pow(1 - decay, hoursPassed));
        }
      });
      
      const boostedPosts = sortedPosts
        .filter(p => p.currentBoostWeight > 0)
        .sort((a, b) => {
          if (b.currentBoostWeight !== a.currentBoostWeight) {
            return b.currentBoostWeight - a.currentBoostWeight;
          }
          return b.date - a.date;
        });
      
      const stakingPosts = getStakingPosts(sortedPosts);
      const organicPosts = sortedPosts
        .filter(p => !p.currentBoostWeight && !stakingPosts.includes(p))
        .sort((a, b) => 
          (b.voters?.length || 0) * 1 + 
          (b.comments?.length || 0) * 0.5 - 
          (a.voters?.length || 0) * 1 - 
          (a.comments?.length || 0) * 0.5);
      
      sortedPosts = [
        ...applyTierRotation(boostedPosts),
        ...stakingPosts,
        ...organicPosts
      ];
      break;
  }
  
  renderPosts(sortedPosts);
}

    // Получить посты для стейкинга
    function getStakingPosts(allPosts) {
      const stakedAmount = getCurrentUserStake(); // Реализовать получение стейка
      const postsCount = STAKING_LEVELS[stakedAmount] || 0;
      
      return allPosts
        .filter(p => !p.boostAmount)
        .sort((a, b) => (b.voters?.length || 0) - (a.voters?.length || 0))
        .slice(0, postsCount);
    }

    // Применить ротацию по уровням
    function applyTierRotation(posts) {
      const rotatedPosts = [];
      const tiers = groupByTiers(posts);
      
      for (const tier of Object.values(tiers)) {
        const rotationIndex = Math.floor(Date.now() / (15 * 60 * 1000)) % tier.length;
        rotatedPosts.push(...tier.slice(rotationIndex), ...tier.slice(0, rotationIndex));
      }
      
      return rotatedPosts.sort((a, b) => 
        b.currentBoostWeight - a.currentBoostWeight);
    }

    // Группировать посты по уровням буста
    function groupByTiers(posts) {
      return posts.reduce((acc, post) => {
        const tier = Object.keys(BOOST_TIERS).reverse().find(t => 
          post.boostAmount >= BOOST_TIERS[t].min && 
          post.boostAmount <= BOOST_TIERS[t].max);
        
        if (tier) {
          if (!acc[tier]) acc[tier] = [];
          acc[tier].push(post);
        }
        return acc;
      }, {});
    }

    // Перемешивание массива
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Переключение подразделов сортировки Top
    

    // Переключение комментариев
    function toggleComments(button) {
      const commentsDiv = button.nextElementSibling;
      if (commentsDiv.style.display === 'none') {
        commentsDiv.style.display = 'block';
        button.textContent = 'Hide comments';
      } else {
        commentsDiv.style.display = 'none';
        const postId = parseInt(button.closest('.post').dataset.id);
        const post = posts.find(p => p.id === postId);
        button.textContent = post.comments && post.comments.length > 0 ? `Comments (${post.comments.length})` : 'Add comment';
      }
    }

    // Добавление комментария
    async function addComment(postId, button) {
      const textarea = button.previousElementSibling;
      const commentText = textarea.value.trim();
      const userIP = await getUserIP();
      
      if (commentText) {
        const post = posts.find(p => p.id === postId);
        if (post) {
          if (!post.comments) post.comments = [];
          const commentId = Date.now();
          post.comments.push({
            id: commentId,
            text: commentText
          });
          
          commentAuthors[commentId] = userIP;
          
          renderPosts(posts);
          await savePosts();
          textarea.value = '';
          
          const postElement = document.querySelector(`.post[data-id="${postId}"]`);
          const commentsDiv = postElement.querySelector('.comments');
          commentsDiv.style.display = 'block';
          commentsDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
      }
    }

    // Начало редактирования комментария
    function startEditComment(postId, commentId, button) {
      const commentDiv = button.closest('.comment');
      const commentContent = commentDiv.querySelector('.comment-text');
      const currentText = commentContent.textContent;
      
      commentDiv.classList.add('editing');
      commentDiv.innerHTML = `
        <textarea class="comment-edit-input">${escapeHtml(currentText)}</textarea>
        <div class="edit-actions">
          <button class="edit-cancel" onclick="cancelEditComment(${postId}, ${commentId}, this)">Cancel</button>
          <button class="edit-save" onclick="saveEditComment(${post.id}, ${comment.id}, this)">Save</button>
        </div>
      `;
    }

    // Сохранение отредактированного комментария
    async function saveEditComment(postId, commentId, button) {
      const commentDiv = button.closest('.comment');
      const textarea = commentDiv.querySelector('.comment-edit-input');
      const newText = textarea.value.trim();
      const userIP = await getUserIP();
      
      if (newText && (commentAuthors[commentId] === userIP || isModerator)) {
        const post = posts.find(p => p.id === postId);
        if (post) {
          const comment = post.comments.find(c => c.id === commentId);
          if (comment) {
            comment.text = newText;
            
            if (isModerator) {
              post.moderatedBy = 'Moderator';
              post.moderatorNote = 'Comment edited by moderator';
            }
            
            renderPosts(posts);
            await savePosts();
          }
        }
      }
    }

    // Отмена редактирования комментария
    function cancelEditComment(postId, commentId) {
      renderPosts(posts);
    }

    // Удаление комментария
    async function deleteComment(postId, commentId) {
      const userIP = await getUserIP();
      
      if ((commentAuthors[commentId] === userIP || isModerator) && confirm('Are you sure you want to delete this comment?')) {
        const post = posts.find(p => p.id === postId);
        if (post) {
          post.comments = post.comments.filter(c => c.id !== commentId);
          delete commentAuthors[commentId];
          
          if (isModerator) {
            post.moderatedBy = 'Moderator';
            post.moderatorNote = 'Comment deleted by moderator';
          }
          
          renderPosts(posts);
          await savePosts();
        }
      }
    }

    // Прямая публикация поста в соцсетях
    function sharePostDirect(platform, postId) {
      const post = posts.find(p => p.id === postId);
      if (!post) return;
      
      const text = `${post.title}\n\n${post.content.substring(0, 200)}...`;
      const url = `https://ToldYouNotToTell.com/#post-${postId}`;
      
      switch(platform) {
        case 'twitter':
          window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
          break;
          
        case 'facebook':
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
          break;
          
        case 'telegram':
          window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
          break;
          
        case 'whatsapp':
          window.open(`https://wa.me/?text=${encodeURIComponent(`${text}\n\n${url}`)}`, '_blank');
          break;
      }
    }

    // Копирование ссылки на пост
    function copyPostLink(postId) {
      const post = posts.find(p => p.id === postId);
      if (!post) return;
      
      const url = `https://ToldYouNotToTell.com/#post-${postId}`;
      navigator.clipboard.writeText(url);
      showTooltip('Post link copied to clipboard!');
    }

    // Скачивание изображения поста
    function downloadPostImage(postId) {
      const post = posts.find(p => p.id === postId);
      if (!post) return;
      
      const postElement = document.querySelector(`.post[data-id="${postId}"]`);
      if (!postElement) return;
      
      // Создаем копию элемента поста для скриншота
      const screenshotContent = document.getElementById('screenshotContent');
      screenshotContent.innerHTML = `
        <div>
          <h3>${escapeHtml(post.title)}</h3>
          <p>${escapeHtml(post.content)}</p>
          <div class="watermark">ToldYouNotToTell.com</div>
        </div>
      `;
      
      // Показываем превью перед скачиванием
      document.getElementById('screenshotPreview').style.display = 'block';
      document.getElementById('screenshotOverlay').style.display = 'block';
      
      // Добавляем кнопку для скачивания
      const downloadBtn = document.createElement('button');
      downloadBtn.textContent = 'Download Image';
      downloadBtn.style.marginTop = '10px';
      downloadBtn.style.padding = '8px 15px';
      downloadBtn.style.background = 'var(--primary-color)';
      downloadBtn.style.color = 'white';
      downloadBtn.style.border = 'none';
      downloadBtn.style.borderRadius = '4px';
      downloadBtn.style.cursor = 'pointer';
      downloadBtn.onclick = function() {
        html2canvas(screenshotContent.querySelector('div')).then(canvas => {
          const link = document.createElement('a');
          link.download = `ToldYouNotToTell-post-${postId}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          closeScreenshot();
        });
      };
      
      screenshotContent.appendChild(downloadBtn);
    }

    // Закрытие окна превью скриншота
    function closeScreenshot() {
      document.getElementById('screenshotPreview').style.display = 'none';
      document.getElementById('screenshotOverlay').style.display = 'none';
    }

    // Рекламный пост
    async function reportPost(postId) {
      const userIP = await getUserIP();
      const post = posts.find(p => p.id === postId);
      
      if (!post) return;
      
      // Проверка, был ли пост уже репортован этим пользователем
      const alreadyReported = reports.some(r => r.postId === postId && r.reporterIP === userIP);
      if (alreadyReported) {
        showTooltip('You have already reported this post.');
        return;
      }
      
      reports.push({
        postId: postId,
        reporterIP: userIP,
        date: new Date(),
        title: post.title,
        content: post.content
      });
      
      await savePosts();
      showTooltip('Thank you for your report. Our moderators will review it.');
      
      // Если модератор, показываем репорт сразу
      if (isModerator) {
        showReportsPanel();
      }
    }

    // Показать панель репортов
    function showReportsPanel() {
      if (!isModerator) return;
      
      const panel = document.getElementById('reportsPanel');
      const list = document.getElementById('reportsList');
      
      list.innerHTML = '';
      
      if (reports.length === 0) {
        list.innerHTML = '<p>No reports to review</p>';
      } else {
        reports.forEach((report, index) => {
          const post = posts.find(p => p.id === report.postId);
          const item = document.createElement('div');
          item.className = 'report-item';
          item.innerHTML = `
            <h4>${escapeHtml(report.title)}</h4>
            <p>${escapeHtml(report.content.substring(0, 100))}...</p>
            <small>Reported on ${formatDate(report.date)}</small>
            <div class="report-actions">
              <button class="report-dismiss" onclick="dismissReport(${index})">Dismiss</button>
              <button class="report-delete" onclick="deleteReportedPost(${index})">Delete Post</button>
            </div>
          `;
          list.appendChild(item);
        });
      }
      
      panel.style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    // Закрыть панель репортов
    function closeReportsPanel() {
      document.getElementById('reportsPanel').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    // Отклонить репорт
    async function dismissReport(index) {
      reports.splice(index, 1);
      await savePosts();
      showReportsPanel();
    }

    // Удалить репорченный пост
    async function deleteReportedPost(index) {
      const report = reports[index];
      const postId = report.postId;
      
      posts = posts.filter(p => p.id !== postId);
      reports.splice(index, 1);
      
      // Переназначение порядковых номеров после удаления
      posts.sort((a, b) => b.date - a.date);
      posts.forEach((post, index) => {
        post.orderNumber = posts.length - index;
      });
      
      renderPosts(posts);
      await savePosts();
      showReportsPanel();
    }

    // Удаление поста
    async function deletePost(postId) {
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const post = posts.find(p => p.id === postId);
      
      if (!post) return;
      
      const isAuthor = walletConnected ? 
        (post.authorWallet === localStorage.getItem('phantomWallet')) : 
        (post.authorIP === userIP);
      
      const timeLeft = getTimeLeftForEdit(post.date);
      
      if (!timeLeft && !isModerator) {
        showTooltip("You can only delete posts within 3 hours of creation.");
        return;
      }
      
      if ((isAuthor || isModerator) && confirm('Are you sure you want to delete this note?')) {
        posts = posts.filter(p => p.id !== postId);
        
        // Переназначение порядковых номеров после удаления
        posts.sort((a, b) => b.date - a.date);
        posts.forEach((post, index) => {
          post.orderNumber = posts.length - index;
        });
        
        renderPosts(posts);
        await savePosts();
      }
    }

    // Редактирование поста
    async function editPost(postId) {
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const post = posts.find(p => p.id === postId);
      
      if (!post) return;
      
      const isAuthor = walletConnected ? 
        (post.authorWallet === localStorage.getItem('phantomWallet')) : 
        (post.authorIP === userIP);
      
      const timeLeft = getTimeLeftForEdit(post.date);
      
      if (!timeLeft && !isModerator) {
        showTooltip("You can only edit posts within 3 hours of creation.");
        return;
      }
      
      if (isAuthor || isModerator) {
        toggleForm(post);
      }
    }

    // Модерация поста
    async function moderatePost(postId) {
      if (!isModerator) return;
      
      const post = posts.find(p => p.id === postId);
      if (!post) return;
      
      const newContent = prompt("Edit the post content:", post.content);
      if (newContent !== null) {
        post.content = newContent;
        post.moderatedBy = 'Moderator';
        post.moderatorNote = 'Content moderated';
        
        renderPosts(posts);
        await savePosts();
      }
    }

    // Буст поста
    async function boostPost(postId) {
      const userIP = await getUserIP();
      const walletConnected = !!localStorage.getItem('phantomWallet');
      const post = posts.find(p => p.id === postId);
      
      if (!post) return;
      
      const isAuthor = walletConnected ? 
        (post.authorWallet === localStorage.getItem('phantomWallet')) : 
        (post.authorIP === userIP);
      
      if (!isAuthor) return;
      
      if (!walletConnected) {
        showTooltip('Please connect your Phantom wallet to boost posts.');
        return;
      }
      
      // В реальном приложении здесь была бы обработка платежа
      const boostAmount = 5; // Базовый уровень
      post.boostAmount = boostAmount;
      post.boostTime = Date.now();
      post.currentBoostWeight = boostAmount;
      
      await savePosts();
      renderPosts(posts);
      
      showTooltip('Post boosted! It will be more visible in the Trending section.');
    }

    // Оплата через USDT
    async function payWithUSDT() {
      if (!phantomWallet) {
        showTooltip('Please connect your Phantom wallet first.');
        return;
      }
      
      try {
        // В реальном приложении здесь была бы обработка платежа
        showTooltip('Payment with USDT would be processed here in a real application.');
      } catch (error) {
        console.error('Payment error:', error);
        showTooltip('Payment failed. Please try again.');
      }
    }

    // Застейкать токены
    async function stakeTokens() {
      if (!phantomWallet) {
        showTooltip('Please connect your Phantom wallet first.');
        return;
      }
      
      const amount = parseFloat(document.getElementById('stakeAmount').value);
      if (isNaN(amount) || amount <= 0) {
        showTooltip('Please enter a valid amount to stake.');
        return;
      }
      
      try {
        // В реальном приложении здесь была бы обработка стейкинга
        showTooltip(`Staking ${amount} TNTT would be processed here in a real application.`);
      } catch (error) {
        console.error('Staking error:', error);
        showTooltip('Staking failed. Please try again.');
      }
    }

    // Получить текущий стейк пользователя
    function getCurrentUserStake() {
      // В реальном приложении здесь было бы получение данных из блокчейна
      return 0;
    }

    // Забрать награды
    async function claimRewards() {
      if (!phantomWallet) {
        showTooltip('Please connect your Phantom wallet first.');
        return;
      }
      
      try {
        // В реальном приложении здесь была бы обработка выплаты наград
        showTooltip('Rewards would be claimed here in a real application.');
      } catch (error) {
        console.error('Claim rewards error:', error);
        showTooltip('Failed to claim rewards. Please try again.');
      }
    }

    // Поиск постов
    function searchPosts(query) {
      query = query.toLowerCase().trim();
      
      if (!query) {
        renderPosts(posts);
        return;
      }
      
      // Проверка, является ли запрос кодом восстановления
      const recoveryPostId = Object.keys(recoveryCodes).find(key => recoveryCodes[key].toLowerCase() === query.toLowerCase());
      if (recoveryPostId) {
        const post = posts.find(p => p.id.toString() === recoveryPostId);
        if (post) {
          renderPosts([post]);
          return;
        }
      }
      
      const filteredPosts = posts.filter(post => {
        if (!isNaN(query) && post.orderNumber === parseInt(query)) {
          return true;
        }
        
        if (post.title.toLowerCase().includes(query)) {
          return true;
        }
        
        if (post.category && post.category.toLowerCase().includes(query)) {
          return true;
        }
        
        return false;
      });
      
      renderPosts(filteredPosts);
    }

    // Переключение темы
    function toggleTheme() {
      currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.body.classList.toggle('light-mode', currentTheme === 'light');
      localStorage.setItem('theme', currentTheme);
      updateThemeIcon();
    }

    // Обновление иконки темы
    function updateThemeIcon() {
      const icon = document.querySelector('.theme-toggle i');
      if (currentTheme === 'dark') {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      } else {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      }
    }

    // Обновление визуального оформления поста
    function updatePostVisuals(post) {
      const element = document.querySelector(`.post[data-id="${post.id}"]`);
      if (!element) return;
      
      // Очистка предыдущих стилей
      element.className = 'post';
      
      if (post.boostAmount) {
        const style = VISUAL_STYLES.BOOST_TIERS[post.boostAmount];
        if (style) {
          element.classList.add(style.class);
          element.style.borderLeft = `4px solid ${style.color}`;
        }
      }
      
      if (post.staking) {
        element.classList.add(VISUAL_STYLES.STAKING.class);
      }
    }
  
// Функции для Presale
function showPresaleModal() {
  document.getElementById('presaleModal').style.display = 'block';
  document.getElementById('overlay').style.display = 'block';
}
function closePresaleModal() {
  document.getElementById('presaleModal').style.display = 'none';
  document.getElementById('overlay').style.display = 'none';
}
async function participatePresale() {
  const amount = parseFloat(document.getElementById('presaleAmount').value);
  if (isNaN(amount)) {
    showTooltip('Please enter a valid amount');
    return;
  }
  if (!phantomWallet) {
    showTooltip('Please connect your Phantom wallet first');
    return;
  }
  try {
    showTooltip(`Success! You've purchased ${amount * 100} TNTT tokens`);
    closePresaleModal();
  } catch (error) {
    console.error('Presale error:', error);
    showTooltip('Presale participation failed. Please try again.');
  }
}

</script>
  
  <!-- Подключение библиотеки для создания скриншотов -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<!-- Presale Modal -->
<div class="presale-modal" id="presaleModal">
  <button class="close-screenshot" onclick="closePresaleModal()">&times;</button>
  <h2><i class="fas fa-coins"></i> TNTT Presale</h2>
  <div style="text-align: center; margin: 20px 0;">
    <p>Participate in our token presale to get early access to TNTT tokens!</p>
    <div style="font-size: 24px; font-weight: bold; margin: 15px 0; color: var(--primary-color);">
      1 USDT = 100 TNTT
    </div>
    <div style="margin-bottom: 20px;">
      <label for="presaleAmount">Amount (USDT):</label>
      <input type="number" id="presaleAmount" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--search-bg); color: var(--text-color);">
    </div>
    <button class="pay-with-usdt" onclick="participatePresale()">
      <i class="fas fa-wallet"></i> Buy with USDT
    </button>
  </div>
</div>

</body>
</html>